<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>H&H Weinfabrik</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link id="dynFavicon" rel="icon" href="">
  <!-- Orbitron als frei nutzbarer Ersatzstil (Antelope-H-Look) -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --wine-900:#12060a;
      --wine-800:#1b0b10;
      --wine-700:#2a121b;
      --ink:#f2eceb;
      --muted:#cdb9b8;
      --line:#3b1d26;
      --focus:#c27c8b55;
      --radius:14px;
      --price-wine:#b31636;
    }

    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      background:var(--wine-900) no-repeat center/cover fixed;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
      line-height:1.45;
    }
    .page{max-width:1280px;margin:0 auto;padding:2rem 1.2rem}

    header{
      display:flex;align-items:center;gap:1rem;flex-wrap:wrap;
      padding:1rem 1.25rem;border:1px solid var(--line);border-radius:var(--radius);
      background:
        radial-gradient(900px 400px at 10% -20%, rgba(194,124,139,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.18));
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
    }
    header img.logo{height:90px;width:auto;object-fit:contain}
    .brand h1{margin:0;font-weight:750;font-size:clamp(1.6rem,3vw,2.2rem)}
    .brand .sub{margin:0;color:var(--muted);font-size:.98rem}

    .header-text{
      margin:1rem 0 1.2rem;padding:1rem 1.2rem;border:1px solid var(--line);
      background:var(--wine-800);border-radius:12px;color:var(--muted)
    }
    .header-text .inner{max-width:50%;white-space:pre-wrap}
    @media (max-width:900px){.header-text .inner{max-width:100%}}

    .hint{
      margin:1rem 0 1.2rem;padding:.85rem 1rem;border:1px solid var(--line);
      background:var(--wine-800);border-radius:12px;color:var(--muted)
    }

    hr.rule{height:1px;border:0;margin:1.4rem 0;background:linear-gradient(90deg,transparent,var(--line),transparent)}

    /* ===== Weine ===== */
    .grid{display:grid;gap:1rem;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:620px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--wine-700);border:1px solid var(--line);border-radius:var(--radius);
      overflow:hidden;cursor:pointer;transition:transform .18s, box-shadow .18s, border-color .18s
    }
    .card:hover{transform:translateY(-2px);box-shadow:0 14px 34px rgba(0,0,0,.35);border-color:var(--focus)}
    .card img{width:100%;height:230px;object-fit:cover;display:block;background:#0b0f16}
    .meta{padding:.85rem 1rem 1rem;text-align:center}
    .name{margin:0 0 .35rem;font-weight:700}

    /* Preise (Orbitron), fett & mittig ‚Äì Text wie im Sheet */
    .price{
      font-family:"Orbitron","Arial Black",sans-serif;
      font-weight:800;
      text-align:center;
      color:var(--price-wine);
      letter-spacing:1px;
      font-size:1.8rem;
      word-break:break-word;
    }

    /* ===== Modal (Wein-Details) ===== */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.6);
      display:none;align-items:center;justify-content:center;padding:1.25rem;z-index:30;
      backdrop-filter:saturate(120%) blur(2px);
    }
    .overlay.show{display:flex}
    .modal{
      width:min(980px,96vw);max-height:92vh;overflow:auto;
      background:var(--wine-700);border:1px solid var(--line);border-radius:18px;
      box-shadow:0 30px 70px rgba(0,0,0,.5)
    }
    .modal-media img{width:100%;height:440px;object-fit:contain;display:block;background:#0b0f16}
    .modal-body{padding:1rem 1.15rem 1.25rem}
    .modal-title{margin:.2rem 0 .35rem;font-size:1.45rem;font-weight:800;text-align:center}
    .modal-price{margin:0 0 .8rem;text-align:center}

    /* Bild2 links (20%), Text rechts (80%); Bild nie h√∂her als die Beschreibung */
    .modal-flex{display:flex;gap:.5rem;align-items:flex-start}
    .modal-left{
      flex:0 0 20%;
      display:flex;align-items:flex-start;justify-content:flex-start;
      overflow:hidden; height:auto; padding:0; /* H√∂he per JS auf Beschreibungs-H√∂he gesetzt */
    }
    .modal-left img{
      width:100%; height:100%; object-fit:contain; display:block;
    }
    .modal-right{flex:1 1 80%;min-width:0}
    .modal-desc{color:var(--muted);white-space:pre-wrap;margin:0}

    @media (max-width:900px){
      .modal-flex{flex-direction:column}
      .modal-left{flex-basis:auto;height:auto}
      .modal-left img{height:auto;max-height:60vh}
    }

    /* ===== Ankauf + Bestellung ===== */
    .ankauf-wrap{
      display:grid;
      gap:1rem;
      align-items:start;
      grid-template-columns:1.3fr 1fr 1fr;  /* Liste | Bild | Bestellung */
      margin:1.4rem 0 .6rem
    }
    @media (max-width:900px){
      .ankauf-wrap{grid-template-columns:1fr}
    }
    .ankauf-list{
      background:var(--wine-800);border:1px solid var(--line);
      border-radius:var(--radius);padding:.8rem .9rem 1rem
    }
    .ankauf-list h2{margin:.2rem 0 .6rem;font-size:1.15rem}
    .ankauf-item{
      display:flex;justify-content:space-between;align-items:center;
      padding:.65rem .7rem;border:1px dashed var(--line);
      border-radius:12px;background:var(--wine-700)
    }
    .ankauf-item .what{font-weight:650}
    .ankauf-item .price{min-width:120px}
    .ankauf-media{
      background:transparent;border:none;padding:0;
      display:flex;justify-content:flex-start;align-items:flex-start;
      height:100%
    }
    .ankauf-media img{
      border:none;background:transparent;max-width:100%;max-height:100%;
      object-fit:contain;object-position:left top;display:block
    }

    /* Bestellung-Box */
    .order-box{
      background:var(--wine-800);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:.9rem 1rem 1rem;
      display:flex;
      flex-direction:column;
      gap:.6rem;
    }
    .order-box h2{
      margin:.2rem 0 .3rem;
      font-size:1.15rem;
    }
    .order-box p{
      margin:0;
      color:var(--muted);
      font-size:.9rem;
    }
    .order-btn{
      margin-top:.4rem;
      align-self:flex-start;
      padding:.5rem 1.2rem;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--wine-700);
      color:var(--ink);
      font-weight:600;
      cursor:pointer;
      letter-spacing:.03em;
      transition:transform .15s, box-shadow .15s, background .15s;
    }
    .order-btn:hover{
      transform:translateY(-1px);
      box-shadow:0 8px 18px rgba(0,0,0,.35);
      background:#3a1520;
    }

    /* ===== Standort & Fotos ===== */
    .section{
      background:var(--wine-800);border:1px solid var(--line);
      border-radius:var(--radius);padding:1rem 1.2rem;margin:1.2rem 0
    }
    .section .desc{color:var(--muted);margin:0 0 .8rem}

    /* Standortbild */
    #standortImg{
      width:100%;
      height:auto;
      object-fit:contain;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0b0f16;
      display:block;
      margin-bottom:1rem;
    }

    /* Photo1 & Photo2 */
    .photo-row{display:grid;gap:.9rem;grid-template-columns:1fr}
    @media (min-width:900px){.photo-row{grid-template-columns:1fr 1fr}}
    .photo{
      width:100%;aspect-ratio:16/9;object-fit:cover;
      border-radius:12px;border:1px solid var(--line)
    }

    footer.footer{margin:1.5rem 0 .5rem;color:var(--muted);font-size:.85rem;text-align:center}
    footer.footer a{color:var(--ink);text-decoration:underline}

    /* ===== Bestell-Modal ===== */
    #orderOverlay .modal{
      width:min(720px,96vw);
    }
    .order-form{
      padding:1rem 1.15rem 1.3rem;
    }
    .order-form h3{
      margin:.2rem 0 .8rem;
      text-align:center;
      font-size:1.4rem;
    }
    .order-row{
      margin-bottom:.75rem;
      display:flex;
      flex-direction:column;
      gap:.25rem;
    }
    .order-row label{
      font-size:.9rem;
      color:var(--muted);
    }
    .order-input, .order-select{
      padding:.45rem .6rem;
      border-radius:8px;
      border:1px solid var(--line);
      background:var(--wine-800);
      color:var(--ink);
      font:inherit;
    }
    .order-input:focus, .order-select:focus{
      outline:2px solid var(--focus);
      outline-offset:1px;
    }
    .order-actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:.75rem;
      margin-top:.9rem;
      flex-wrap:wrap;
    }
    .order-total{
      font-size:.95rem;
      color:var(--muted);
    }
    .order-total strong{
      color:var(--ink);
    }
    .order-submit{
      padding:.55rem 1.4rem;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--price-wine);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      letter-spacing:.04em;
      text-transform:uppercase;
      font-size:.85rem;
      transition:transform .15s, box-shadow .15s, filter .15s;
    }
    .order-submit:hover{
      transform:translateY(-1px);
      box-shadow:0 10px 22px rgba(0,0,0,.45);
      filter:brightness(1.05);
    }
    .order-status{
      margin-top:.6rem;
      font-size:.9rem;
      color:var(--muted);
      min-height:1.1em;
    }
    .order-status.ok{
      color:#7dd97d;
    }
    .order-status.err{
      color:#ff9aa2;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <img class="logo" id="logoImg" alt="Logo" />
      <div class="brand">
        <h1>H&amp;H Weinfabrik</h1>
        <p class="sub" id="logoDesc"></p>
      </div>
    </header>

    <!-- Header-Text -->
    <div id="headerText" class="header-text" hidden><div class="inner" id="headerTextInner"></div></div>

    <!-- Ladehinweis -->
    <div id="hint" class="hint">üîÑ Lade Daten aus Google Sheets ‚Ä¶</div>

    <!-- Weine -->
    <section>
      <div id="weineGrid" class="grid"></div>
    </section>

    <hr class="rule" />

    <!-- Ankauf + Bestellung -->
    <section>
      <div class="ankauf-wrap">
        <div class="ankauf-list" id="ankaufListBlock">
          <h2>Ankauf</h2>
          <ul id="ankaufList"></ul>
        </div>
        <div class="ankauf-media"><img id="ankaufImg" alt="Ankauf"></div>

        <!-- Bestellung-Box -->
        <div class="order-box">
          <h2>Bestellung</h2>
          <p>Sie m√∂chten einen unserer Weine bestellen? √ñffnen Sie das Bestellformular und senden Sie uns Ihre Anfrage direkt.</p>
          <button id="openOrderBtn" class="order-btn" type="button">Bestellen</button>
        </div>
      </div>
    </section>

    <!-- Standort -->
    <section class="section" id="standortSection" hidden>
      <h2>Standort</h2>
      <p class="desc" id="standortDesc"></p>
      <img id="standortImg" alt="Standort" />
      <div class="photo-row">
        <img id="photo1" class="photo" alt="Foto 1" />
        <img id="photo2" class="photo" alt="Foto 2" />
      </div>
    </section>

    <!-- Footer -->
    <footer id="siteFooter" class="footer" hidden>
      <div id="footerDesc"></div>
      <div><a id="footerLink" href="#" target="_blank" rel="noopener"></a></div>
    </footer>
  </div>

  <!-- Wein-Modal -->
  <div id="overlay" class="overlay">
    <div class="modal">
      <div class="modal-media"><img id="modalImg" alt=""></div>
      <div class="modal-body">
        <h3 id="modalTitle" class="modal-title"></h3>
        <div id="modalPrice" class="modal-price price"></div>

        <!-- Bild2 links (20%), Text rechts (80%) -->
        <div class="modal-flex" id="modalFlex">
          <div class="modal-left" id="modalLeft">
            <img id="modalImg2" alt="Weinbild 2">
          </div>
          <div class="modal-right">
            <div id="modalDesc" class="modal-desc"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Bestell-Modal -->
  <div id="orderOverlay" class="overlay">
    <div class="modal">
      <div class="order-form">
        <h3>Bestellung aufgeben</h3>
        <form id="orderForm">
          <div class="order-row">
            <label for="orderName">Ihr Name</label>
            <input id="orderName" name="name" class="order-input" required />
          </div>
          <div class="order-row">
            <label for="orderContact">Kontaktdaten (E-Mail, Telefon o.√§.)</label>
            <input id="orderContact" name="contact" class="order-input" required />
          </div>
          <div class="order-row">
            <label for="orderWine">Wein-Auswahl</label>
            <select id="orderWine" name="wine" class="order-select" required>
              <option value="">Bitte Wein ausw√§hlen ‚Ä¶</option>
            </select>
          </div>
          <div class="order-row">
            <label for="orderQty">Anzahl</label>
            <input id="orderQty" name="qty" type="number" min="1" value="1" class="order-input" required />
          </div>

          <div class="order-actions">
            <div class="order-total">
              Gesamtpreis: <strong id="orderTotal">‚Äì</strong>
            </div>
            <button type="submit" class="order-submit">Bestellung senden</button>
          </div>
          <div id="orderStatus" class="order-status" aria-live="polite"></div>
        </form>
      </div>
    </div>
  </div>

<script>
const SHEET_ID="18Q64WpaE2NAEmva0Y8dABSamcMfzcbVp2CJ1ToZ9Il8";
const TAB_WEBSITE="Website",TAB_WEINE="Weine",TAB_ANKAUF="Ankauf";
const DISCORD_WEBHOOK="https://discord.com/api/webhooks/1409574315598544906/zyhruAAcS2YgKTAWFb4TzR3XnDgzVma3f44Hygdn5tFY7RsXHOMgtTiMzQSZMzb3fX_a";

const logoImg=document.getElementById("logoImg"),logoDescEl=document.getElementById("logoDesc");
const headerText=document.getElementById("headerText"),headerTextInner=document.getElementById("headerTextInner");
const hintEl=document.getElementById("hint");
const weineGrid=document.getElementById("weineGrid");
const ankaufList=document.getElementById("ankaufList"),ankaufImg=document.getElementById("ankaufImg"),ankaufListBlock=document.getElementById("ankaufListBlock");
const standortSection=document.getElementById("standortSection"),standortDescEl=document.getElementById("standortDesc"),
      standortImg=document.getElementById("standortImg"),photo1Img=document.getElementById("photo1"),photo2Img=document.getElementById("photo2");
const siteFooter=document.getElementById("siteFooter"),footerDescEl=document.getElementById("footerDesc"),footerLinkEl=document.getElementById("footerLink");

const overlay=document.getElementById("overlay"),modalImg=document.getElementById("modalImg"),modalTitle=document.getElementById("modalTitle"),
      modalPrice=document.getElementById("modalPrice"),modalDesc=document.getElementById("modalDesc"),modalImg2=document.getElementById("modalImg2"),
      modalLeft=document.getElementById("modalLeft");

const faviconEl=document.getElementById("dynFavicon");

// Bestell-UI
const openOrderBtn=document.getElementById("openOrderBtn");
const orderOverlay=document.getElementById("orderOverlay");
const orderForm=document.getElementById("orderForm");
const orderWineSelect=document.getElementById("orderWine");
const orderQtyInput=document.getElementById("orderQty");
const orderTotalEl=document.getElementById("orderTotal");
const orderStatusEl=document.getElementById("orderStatus");

let weinDaten=[];

/* Google Sheets GViz Loader */
function gvizJSONP(sheet){
  return new Promise((res,rej)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    const u=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json,responseHandler:${cb}&headers=1&sheet=${sheet}`;
    const s=document.createElement("script");
    let to=setTimeout(()=>{rej("Timeout "+sheet);cleanup();},15000);
    function cleanup(){clearTimeout(to);try{delete window[cb];}catch{}s.remove();}
    window[cb]=p=>{
      cleanup();
      try{
        const c=p.table.cols.map(c=>(c.label||c.id||"").trim());
        const r=p.table.rows.map(r=>{
          const o={};(r.c||[]).forEach((x,i)=>o[c[i]||"c"+i]=x?x.v:"");return o;
        });
        res(r);
      }catch(e){rej(e);}
    };
    s.src=u;document.head.appendChild(s);
  });
}

/* Euroformat nur f√ºr Ankauf (numerisch) */
function euro(v){
  if(v==null||v==="")return"";
  let s=String(v).trim().replace(/[^\d.,-]/g,"");
  if(!s)return"";
  const d=s.lastIndexOf("."),c=s.lastIndexOf(",");const comma=c>d;
  if(comma){s=s.replace(/\./g,"").replace(",",".");}else{s=s.replace(/,/g,"");}
  const n=Number(s);return isFinite(n)?n.toLocaleString("de-DE")+" ‚Ç¨":String(v);
}
function euroProStueck(v){const t=euro(v);return t? t.replace(/\s*‚Ç¨$/," ‚Ç¨")+"/St.":"";}

/* Preistext aus Weine-Zeile: zuerst Preis_Anzeige, sonst Preis */
function getPreisText(row){
  const pa = row.Preis_Anzeige !== undefined ? String(row.Preis_Anzeige||"").trim() : "";
  if(pa) return pa;
  const p = row.Preis !== undefined ? String(row.Preis||"").trim() : "";
  return p;
}

/* Karten */
function buildWineCard(w){
  const c=document.createElement("article");c.className="card";
  const img=document.createElement("img");img.src=w.BildAI||w.Bild||"";img.alt=w.Name||"Wein";
  const meta=document.createElement("div");meta.className="meta";
  const name=document.createElement("p");name.className="name";name.textContent=w.Name||"";
  const price=document.createElement("div");price.className="price";price.textContent=w.Preis||"";
  meta.append(name,price);c.append(img,meta);
  c.onclick=()=>showModal(w);
  return c;
}

/* Modal anzeigen */
function showModal(w){
  modalImg.src=w.BildAI||w.Bild||"";
  modalTitle.textContent=w.Name||"";
  modalPrice.textContent=w.Preis||"";
  modalDesc.textContent=(w.Beschreibung||"").toString().trim();

  if(w.Bild2){
    modalImg2.src=w.Bild2;
    modalLeft.style.display="flex";
    modalImg2.style.display="block";
    if(modalImg2.complete){ syncModalHeights(); }
    else { modalImg2.onload = ()=>syncModalHeights(); }
  }else{
    modalImg2.removeAttribute("src");
    modalImg2.style.display="none";
    modalLeft.style.display="none";
  }

  overlay.classList.add("show");
  requestAnimationFrame(syncModalHeights);
}

/* Klick au√üerhalb schlie√üt Wein-Modal */
overlay.addEventListener("click",e=>{
  if(e.target===overlay) overlay.classList.remove("show");
});

/* Bild2 nie h√∂her als NUR der Beschreibungs-Block (#modalDesc) */
function syncModalHeights(){
  if(window.matchMedia("(max-width: 900px)").matches){
    modalLeft.style.height = "auto";
    return;
  }
  if(modalLeft.style.display==="none") return;
  const descH = modalDesc.getBoundingClientRect().height;
  modalLeft.style.height = Math.max(descH, 80) + "px"; // Mindesth√∂he 80px
}

/* Ankauf-H√∂hensync */
function syncAnkaufHeights(){
  const h=ankaufListBlock.getBoundingClientRect().height;
  ankaufImg.style.maxHeight=h+"px";
}

/* Preis-Parsing f√ºr Gesamtpreis (Versuch: erste Zahl) */
function parseUnitPrice(text){
  if(!text) return NaN;
  const m = String(text).match(/(\d[\d\.]*)/);
  if(!m) return NaN;
  const numStr = m[1].replace(/\./g,"");
  const n = Number(numStr);
  return isFinite(n) ? n : NaN;
}

function updateOrderTotal(){
  const idx = orderWineSelect.value;
  const qty = parseInt(orderQtyInput.value,10) || 0;

  if(!idx || !weinDaten[idx] || qty<=0){
    orderTotalEl.textContent="‚Äì";
    return;
  }
  const w = weinDaten[idx];
  const unit = parseUnitPrice(w.Preis);
  if(isNaN(unit)){
    // Fallback: zeige einfach den Preistext
    orderTotalEl.textContent = w.Preis ? w.Preis + " √ó " + qty : "‚Äì";
  }else{
    const total = unit * qty;
    orderTotalEl.textContent = total.toLocaleString("de-DE") + " ‚Ç¨";
  }
}

/* Bestell-Overlay √∂ffnen/schlie√üen */
openOrderBtn.addEventListener("click",()=>{
  orderStatusEl.textContent="";
  orderStatusEl.className="order-status";
  orderOverlay.classList.add("show");
  updateOrderTotal();
});

orderOverlay.addEventListener("click",e=>{
  if(e.target===orderOverlay) orderOverlay.classList.remove("show");
});

/* Total neu berechnen bei √Ñnderungen */
orderWineSelect.addEventListener("change",updateOrderTotal);
orderQtyInput.addEventListener("input",updateOrderTotal);

/* Bestellung absenden -> an Discord-Webhook */
orderForm.addEventListener("submit",async e=>{
  e.preventDefault();
  orderStatusEl.textContent="";
  orderStatusEl.className="order-status";

  const name = document.getElementById("orderName").value.trim();
  const contact = document.getElementById("orderContact").value.trim();
  const idx = orderWineSelect.value;
  const qty = parseInt(orderQtyInput.value,10) || 0;

  if(!name || !contact || !idx || !weinDaten[idx] || qty<=0){
    orderStatusEl.textContent="Bitte alle Felder korrekt ausf√ºllen.";
    orderStatusEl.classList.add("err");
    return;
  }

  const w = weinDaten[idx];
  const unitText = w.Preis || "k.A.";
  const totalText = orderTotalEl.textContent || "k.A.";

  const content =
`Neue Weinbestellung bei H&H Weinfabrik:
Name: ${name}
Kontakt: ${contact}

Wein: ${w.Name}
Preis (Angabe): ${unitText}
Anzahl: ${qty}
Gesamtpreis (berechnet/Anzeige): ${totalText}`;

  try{
    orderStatusEl.textContent="Sende Bestellung ‚Ä¶";
    const res = await fetch(DISCORD_WEBHOOK,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({content})
    });
    // Wir pr√ºfen die Antwort nicht hart, da CORS/no-cors greifen kann.
    orderStatusEl.textContent="Danke f√ºr Ihre Bestellung!";
    orderStatusEl.classList.add("ok");
    // Optional Formular zur√ºcksetzen, Wein/Anzahl beibehalten oder zur√ºcksetzen:
    // orderForm.reset();
    setTimeout(()=>{orderOverlay.classList.remove("show");},1200);
  }catch(err){
    console.error(err);
    orderStatusEl.textContent="Fehler beim Senden der Bestellung. Bitte sp√§ter erneut versuchen.";
    orderStatusEl.classList.add("err");
  }
});

/* Init */
(async()=>{
  try{
    const [ws,weine,ank]=await Promise.all([gvizJSONP(TAB_WEBSITE),gvizJSONP(TAB_WEINE),gvizJSONP(TAB_ANKAUF)]);

    // Website
    let logo="",bg="",fav="",descLogo="",headerDesc="",ankImgURL="",standort="",descStandort="",p1="",p2="",footerD="",footerL="";
    ws.forEach(r=>{
      const f=(r.Funktion||"").toLowerCase();
      if(f==="logo"){logo=r.Link;descLogo=r.Beschreibung}
      if(f==="hintergrund"){bg=r.Link}
      if(f==="favicon-link"||f==="favicon"){fav=r.Link}
      if(f==="header"){headerDesc=r.Beschreibung}
      if(f==="ankauf"){ankImgURL=r.Link}
      if(f==="standort"){standort=r.Link;descStandort=r.Beschreibung}
      if(f==="photo1"){p1=r.Link}
      if(f==="photo2"){p2=r.Link}
      if(f==="footer"){footerD=r.Beschreibung;footerL=r.Link}
    });
    if(logo)logoImg.src=logo;
    if(bg)document.body.style.backgroundImage=`url('${bg}')`;
    if(fav)faviconEl.href=fav;
    logoDescEl.textContent=descLogo||"";
    if(headerDesc){headerTextInner.textContent=headerDesc;headerText.hidden=false;}

    // Weine (BildAI als Hauptbild, Bild2 f√ºr Modal links)
    weineGrid.innerHTML="";
    weinDaten=[];
    weine.forEach((r,idx)=>{
      const preisText = getPreisText(r);
      const w={
        ID:r.ID,
        Name:r.Name,
        Beschreibung:r.Beschreibung,
        Preis:preisText,
        BildAI:r.BildAI,
        Bild2:r.Bild2,
        Bild:r.Bild
      };
      if(w.Name&&(w.BildAI||w.Bild)){
        const card = buildWineCard(w);
        weineGrid.append(card);
        weinDaten.push(w);
      }
    });

    // Bestell-Select f√ºllen
    orderWineSelect.innerHTML='<option value="">Bitte Wein ausw√§hlen ‚Ä¶</option>';
    weinDaten.forEach((w,idx)=>{
      const opt=document.createElement("option");
      opt.value=String(idx);
      opt.textContent=w.Name || ("Wein " + (idx+1));
      orderWineSelect.appendChild(opt);
    });

    // Ankauf
    if(ankImgURL)ankaufImg.src=ankImgURL;
    ankaufList.innerHTML="";
    ank.forEach(a=>{
      const li=document.createElement("li");li.className="ankauf-item";
      li.innerHTML=`<div class="what">${a.Anwendung||""}</div><div class="price">${euroProStueck(a.Preis||"")}</div>`;
      ankaufList.append(li);
    });

    // Standort & Fotos
    if(standort||descStandort||p1||p2){
      standortSection.hidden=false;
      standortDescEl.textContent=descStandort||"";
      if(standort)standortImg.src=standort;
      if(p1)photo1Img.src=p1;
      if(p2)photo2Img.src=p2;
    }

    // Footer
    if(footerD||footerL){
      if(footerD)footerDescEl.textContent=footerD;
      if(footerL){footerLinkEl.textContent=footerL;footerLinkEl.href=footerL;}
      siteFooter.hidden=false;
    }

  }catch(e){
    console.error(e);
    const err=document.createElement("div");err.className="hint";err.textContent="‚ùå Fehler beim Laden: "+e;
    document.querySelector(".page").prepend(err);
  }finally{
    // Ladehinweis immer entfernen + H√∂hensyncs
    if(hintEl && hintEl.parentNode) hintEl.parentNode.removeChild(hintEl);
    syncAnkaufHeights();
    window.addEventListener("resize",()=>{ syncAnkaufHeights(); syncModalHeights(); updateOrderTotal(); });
  }
})();
</script>
</body>
</html>
